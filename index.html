<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ù„ÛŒØ³Øª Ù¾Ø±Ø§Ú©Ø³ÛŒâ€ŒÙ‡Ø§ÛŒ ØªÙ„Ú¯Ø±Ø§Ù…</title>
<style>
    @import url('https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css');
    body {
        font-family: "Vazir", sans-serif, Tahoma, Arial;
        background: #f0f2f5;
        margin: 0;
        padding: 0;
        transition: background-color 0.3s ease;
        color: #222;
    }
    .dark-mode {
        background: #121212;
        color: #eee;
    }
    header {
        background: #0052cc;
        color: white;
        padding: 1rem 1.5rem;
        text-align: center;
        font-size: 1.4rem;
        font-weight: bold;
        box-shadow: 0 4px 8px rgb(0 0 0 / 0.1);
        position: sticky;
        top: 0;
        z-index: 100;
    }
    .container {
        max-width: 980px;
        margin: 1rem auto 3rem;
        padding: 0 1rem;
    }
    .toolbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 8px;
        margin-bottom: 1rem;
    }
    .toolbar > * {
        flex: 1 1 auto;
        min-width: 120px;
    }
    input[type="text"] {
        padding: 8px 12px;
        font-size: 1rem;
        border-radius: 8px;
        border: 1px solid #aaa;
        transition: border-color 0.3s ease;
    }
    input[type="text"]:focus {
        outline: none;
        border-color: #0052cc;
        box-shadow: 0 0 6px #0052ccaa;
    }
    button {
        background: #0052cc;
        color: white;
        border: none;
        padding: 10px 16px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        transition: background-color 0.25s ease;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
    }
    button:disabled {
        background: #888;
        cursor: not-allowed;
    }
    button:hover:not(:disabled) {
        background: #003a99;
    }
    .proxy-counts {
        margin-bottom: 1rem;
        display: flex;
        gap: 12px;
        font-weight: 700;
        font-size: 1rem;
        justify-content: center;
        flex-wrap: wrap;
    }
    .count-badge {
        padding: 6px 14px;
        border-radius: 20px;
        color: white;
        min-width: 90px;
        text-align: center;
        box-shadow: 0 2px 6px rgb(0 0 0 / 0.15);
        user-select: none;
    }
    .count-all {
        background: #666;
    }
    .count-good {
        background: #28a745;
    }
    .count-medium {
        background: #ffc107;
        color: #222;
    }
    .count-bad {
        background: #dc3545;
    }

    /* Proxy cards */
    .proxy-list {
        display: grid;
        grid-template-columns: repeat(auto-fill,minmax(280px,1fr));
        gap: 1rem;
    }
    .proxy-card {
        background: white;
        border-radius: 12px;
        box-shadow: 0 3px 8px rgb(0 0 0 / 0.1);
        padding: 16px;
        color: #222;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        transition: transform 0.2s ease, box-shadow 0.25s ease;
        cursor: default;
    }
    .dark-mode .proxy-card {
        background: #1e1e1e;
        color: #eee;
        box-shadow: 0 3px 10px rgb(255 255 255 / 0.05);
    }
    .proxy-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 20px rgb(0 0 0 / 0.15);
    }
    .proxy-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
    }
    .proxy-server {
        font-weight: 700;
        font-size: 1.1rem;
        display: flex;
        align-items: center;
        gap: 10px;
    }
    .status-badge {
        border-radius: 14px;
        padding: 4px 10px;
        font-weight: 700;
        font-size: 0.85rem;
        display: flex;
        align-items: center;
        gap: 6px;
        user-select: none;
        width: fit-content;
    }
    .status-good {
        background-color: #d4edda;
        color: #155724;
    }
    .status-medium {
        background-color: #fff3cd;
        color: #856404;
    }
    .status-bad {
        background-color: #f8d7da;
        color: #721c24;
    }
    .status-unknown {
        background-color: #e2e3e5;
        color: #6c757d;
    }
    .proxy-info {
        font-size: 0.9rem;
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
        color: #555;
    }
    .proxy-info div {
        display: flex;
        align-items: center;
        gap: 6px;
    }
    .proxy-info i {
        min-width: 18px;
        text-align: center;
    }
    .secret-box {
        background: #f9f9f9;
        border-radius: 8px;
        font-family: monospace;
        font-size: 0.85rem;
        padding: 8px 12px;
        word-break: break-all;
        margin-bottom: 12px;
        color: #333;
    }
    .dark-mode .secret-box {
        background: #2b2b2b;
        color: #ccc;
    }
    .proxy-actions {
        display: flex;
        gap: 8px;
    }
    .proxy-actions button {
        flex: 1;
        font-size: 0.9rem;
        padding: 8px;
    }
    .loading-spinner {
        border: 3px solid #ccc;
        border-top: 3px solid #0052cc;
        border-radius: 50%;
        width: 16px;
        height: 16px;
        animation: spin 1s linear infinite;
        display: inline-block;
    }
    @keyframes spin {
        0% {transform: rotate(0deg);}
        100% {transform: rotate(360deg);}
    }

    /* Toast notifications */
    .toast {
        position: fixed;
        top: 20px;
        right: 20px;
        background: #222;
        color: white;
        padding: 12px 20px;
        border-radius: 12px;
        box-shadow: 0 3px 10px rgba(0,0,0,0.3);
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s ease, transform 0.3s ease;
        font-weight: 600;
        user-select: none;
        z-index: 110;
    }
    .toast.show {
        opacity: 1;
        pointer-events: auto;
        transform: translateY(0);
    }
    .toast.success {
        background-color: #28a745;
    }
    .toast.error {
        background-color: #dc3545;
    }
    .toast.warning {
        background-color: #ffc107;
        color: #222;
    }
    .toast.info {
        background-color: #007bff;
    }

    /* Filter and toggle dark mode */
    .filters {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        margin-bottom: 1rem;
        justify-content: center;
    }
    .filters select, .filters input[type=text] {
        padding: 8px 10px;
        font-size: 1rem;
        border-radius: 8px;
        border: 1px solid #aaa;
        min-width: 140px;
        transition: border-color 0.3s ease;
    }
    .filters select:focus, .filters input[type=text]:focus {
        outline: none;
        border-color: #0052cc;
        box-shadow: 0 0 6px #0052ccaa;
    }
    .dark-toggle {
        display: flex;
        align-items: center;
        gap: 8px;
        cursor: pointer;
        user-select: none;
        font-weight: 700;
        font-size: 0.9rem;
        color: #0052cc;
    }
    .dark-toggle input {
        cursor: pointer;
        width: 20px;
        height: 20px;
    }

    /* Responsive */
    @media (max-width: 480px) {
        .proxy-info {
            flex-direction: column;
            gap: 6px;
        }
        .toolbar {
            flex-direction: column;
            gap: 12px;
        }
        button {
            width: 100%;
        }
        .proxy-actions {
            flex-direction: column;
        }
    }

</style>
</head>
<body>

<header>ğŸ“¡ Ù¾Ø±Ø§Ú©Ø³ÛŒâ€ŒÙ‡Ø§ÛŒ ØªÙ„Ú¯Ø±Ø§Ù… - Ù„ÛŒØ³Øª Ø¨Ù‡ Ø±ÙˆØ²</header>

<div class="container">

    <div class="toolbar">
        <input type="text" id="searchInput" placeholder="Ø¬Ø³ØªØ¬Ùˆ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø³Ø±ÙˆØ± ÛŒØ§ Ú©Ø´ÙˆØ±..." />
        <select id="filterCountry">
            <option value="">Ù‡Ù…Ù‡ Ú©Ø´ÙˆØ±Ù‡Ø§</option>
        </select>
        <button id="refreshBtn"><i class="fa-solid fa-arrows-rotate"></i> Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ</button>
        <button id="testAllBtn"><i class="fa-solid fa-bolt-lightning"></i> ØªØ³Øª Ù‡Ù…Ù‡</button>
        <label class="dark-toggle" title="Ø­Ø§Ù„Øª ØªØ§Ø±ÛŒÚ©">
            <input type="checkbox" id="darkModeToggle" />
            <span>Ø­Ø§Ù„Øª ØªØ§Ø±ÛŒÚ©</span>
        </label>
    </div>

    <div class="proxy-counts">
        <div class="count-badge count-all">ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„: <span id="proxyCount">0</span></div>
        <div class="count-badge count-good">Ø¹Ø§Ù„ÛŒ: <span id="activeCount">0</span></div>
        <div class="count-badge count-medium">Ù…ØªÙˆØ³Ø·: <span id="mediumCount">0</span></div>
        <div class="count-badge count-bad">Ø¶Ø¹ÛŒÙ: <span id="badCount">0</span></div>
    </div>

    <div class="proxy-list" id="proxyList"></div>

    <div style="text-align:center; margin-top: 20px;">
        <button id="loadMoreBtn" style="display:none;">Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¨ÛŒØ´ØªØ±</button>
    </div>

    <div style="margin-top: 2rem; font-size: 0.9rem; color: #555; text-align:center;">
        <p>Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù¾Ø±Ø§Ú©Ø³ÛŒâ€ŒÙ‡Ø§ÛŒ MTProtoØŒ Ø±ÙˆÛŒ Ø¯Ú©Ù…Ù‡ Ø§ØªØµØ§Ù„ Ú©Ù„ÛŒÚ© Ú©Ù†ÛŒØ¯ ØªØ§ ØªÙ„Ú¯Ø±Ø§Ù… Ø´Ù…Ø§ Ø¨Ù‡ ØµÙˆØ±Øª Ø®ÙˆØ¯Ú©Ø§Ø± Ø¨Ù‡ Ù¾Ø±Ø§Ú©Ø³ÛŒ Ù…ØªØµÙ„ Ø´ÙˆØ¯.</p>
        <p>Ø¯Ø± ØµÙˆØ±Øª Ù†ÛŒØ§Ø²ØŒ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ù„ÛŒÙ†Ú© Ù¾Ø±Ø§Ú©Ø³ÛŒ Ø±Ø§ Ú©Ù¾ÛŒ Ùˆ Ø¨Ù‡ ØµÙˆØ±Øª Ø¯Ø³ØªÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.</p>
    </div>

</div>

<!-- Toast notifications container -->
<div id="toastContainer"></div>

<script>
(() => {
    'use strict';

    // ØªØ±Ø¬Ù…Ù‡ Ú©Ø´ÙˆØ±Ù‡Ø§ Ø¨Ø§ Ù¾Ø±Ú†Ù…
    const countryTranslations = {
        'Russia': 'ğŸ‡·ğŸ‡º Ø±ÙˆØ³ÛŒÙ‡', 'Netherlands': 'ğŸ‡³ğŸ‡± Ù‡Ù„Ù†Ø¯', 'United States': 'ğŸ‡ºğŸ‡¸ Ø¢Ù…Ø±ÛŒÚ©Ø§',
        'Germany': 'ğŸ‡©ğŸ‡ª Ø¢Ù„Ù…Ø§Ù†', 'France': 'ğŸ‡«ğŸ‡· ÙØ±Ø§Ù†Ø³Ù‡', 'United Kingdom': 'ğŸ‡¬ğŸ‡§ Ø§Ù†Ú¯Ù„Ø³ØªØ§Ù†',
        'Canada': 'ğŸ‡¨ğŸ‡¦ Ú©Ø§Ù†Ø§Ø¯Ø§', 'Italy': 'ğŸ‡®ğŸ‡¹ Ø§ÛŒØªØ§Ù„ÛŒØ§', 'Spain': 'ğŸ‡ªğŸ‡¸ Ø§Ø³Ù¾Ø§Ù†ÛŒØ§', 'Turkey': 'ğŸ‡¹ğŸ‡· ØªØ±Ú©ÛŒÙ‡',
        'Finland': 'ğŸ‡«ğŸ‡® ÙÙ†Ù„Ø§Ù†Ø¯', 'Sweden': 'ğŸ‡¸ğŸ‡ª Ø³ÙˆØ¦Ø¯', 'Poland': 'ğŸ‡µğŸ‡± Ù„Ù‡Ø³ØªØ§Ù†', 'Iran': 'ğŸ‡®ğŸ‡· Ø§ÛŒØ±Ø§Ù†'
    };
    const getCountryName = (country) => countryTranslations[country] || `ğŸŒ ${country || 'Ù†Ø§Ù…Ø´Ø®Øµ'}`;

    let allProxies = [];
    let visibleProxies = [];
    const perPage = 9;
    let currentFilterCountry = '';
    let searchTerm = '';

    const elements = {
        refreshBtn: document.getElementById('refreshBtn'),
        testAllBtn: document.getElementById('testAllBtn'),
        proxyCount: document.getElementById('proxyCount'),
        activeCount: document.getElementById('activeCount'),
        mediumCount: document.getElementById('mediumCount'),
        badCount: document.getElementById('badCount'),
        proxyList: document.getElementById('proxyList'),
        loadMoreBtn: document.getElementById('loadMoreBtn'),
        filterCountry: document.getElementById('filterCountry'),
        searchInput: document.getElementById('searchInput'),
        darkModeToggle: document.getElementById('darkModeToggle'),
        toastContainer: document.getElementById('toastContainer')
    };

    // ÙˆØ¶Ø¹ÛŒØª Ù¾Ø±Ø§Ú©Ø³ÛŒ
    const getStatusInfo = (status) => {
        switch(status) {
            case 'good': return { text: 'Ø¹Ø§Ù„ÛŒ', className: 'status-good', icon: 'fa-solid fa-circle-check' };
            case 'medium': return { text: 'Ù…ØªÙˆØ³Ø·', className: 'status-medium', icon: 'fa-solid fa-triangle-exclamation' };
            case 'bad': return { text: 'Ø¶Ø¹ÛŒÙ', className: 'status-bad', icon: 'fa-solid fa-circle-xmark' };
            default: return { text: 'Ù†Ø§Ù…Ø´Ø®Øµ', className: 'status-unknown', icon: 'fa-solid fa-circle-question' };
        }
    };

    // Ø§ÛŒØ¬Ø§Ø¯ Ú©Ø§Ø±Øª Ù¾Ø±Ø§Ú©Ø³ÛŒ
    const createProxyCard = (proxy) => {
        const statusInfo = getStatusInfo(proxy.status);
        return `
        <div class="proxy-card" id="proxy-${proxy.id}">
            <div class="proxy-header">
                <div class="proxy-server">
                    <i class="fa-solid fa-server"></i> ${proxy.server}
                </div>
                <div class="status-badge ${statusInfo.className}">
                    <i class="${statusInfo.icon}"></i> ${statusInfo.text}
                </div>
            </div>
            <div class="proxy-info">
                <div><i class="fa-solid fa-location-dot"></i> ${proxy.country}</div>
                <div><i class="fa-solid fa-ethernet"></i> Ù¾ÙˆØ±Øª: ${proxy.port}</div>
                <div><i class="fa-solid fa-key"></i> Ú©Ù„ÛŒØ¯: <span class="secret-text">${proxy.secret}</span></div>
            </div>
            <div class="proxy-actions">
                <button class="ping-btn" data-id="${proxy.id}" title="ØªØ³Øª"><i class="fa-solid fa-bolt"></i></button>
                <button class="copy-btn" data-id="${proxy.id}" title="Ú©Ù¾ÛŒ"><i class="fa-solid fa-copy"></i></button>
                <button class="connect-btn" data-id="${proxy.id}" title="Ø§ØªØµØ§Ù„"><i class="fa-solid fa-paper-plane"></i></button>
            </div>
        </div>`;
    };

    // Ù†Ù…Ø§ÛŒØ´ Ù¾Ø±Ø§Ú©Ø³ÛŒâ€ŒÙ‡Ø§ Ø¨Ø± Ø§Ø³Ø§Ø³ ÙÛŒÙ„ØªØ± Ùˆ Ø¬Ø³ØªØ¬Ùˆ
    const renderProxies = () => {
        const filtered = allProxies.filter(p => {
            const matchesCountry = currentFilterCountry ? p.country.includes(currentFilterCountry) : true;
            const matchesSearch = searchTerm ? (p.server.includes(searchTerm) || p.country.includes(searchTerm)) : true;
            return matchesCountry && matchesSearch;
        });
        visibleProxies = filtered.slice(0, perPage);
        elements.proxyList.innerHTML = visibleProxies.map(createProxyCard).join('');
        elements.loadMoreBtn.style.display = filtered.length > perPage ? 'inline-block' : 'none';
        updateCounts(filtered);
        attachEventListeners();
    };

    // Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ ØªØ¹Ø¯Ø§Ø¯ Ù¾Ø±Ø§Ú©Ø³ÛŒâ€ŒÙ‡Ø§
    const updateCounts = (list = allProxies) => {
        elements.proxyCount.textContent = list.length;
        elements.activeCount.textContent = list.filter(p => p.status === 'good').length;
        elements.mediumCount.textContent = list.filter(p => p.status === 'medium').length;
        elements.badCount.textContent = list.filter(p => p.status === 'bad').length;
    };

    // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù¾Ø±Ø§Ú©Ø³ÛŒâ€ŒÙ‡Ø§ Ø§Ø² Ù…Ù†Ø¨Ø¹
    const loadProxies = async () => {
        elements.refreshBtn.disabled = true;
        elements.refreshBtn.innerHTML = `<i class="fa-solid fa-spinner fa-spin"></i> Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...`;
        try {
            const res = await fetch("https://raw.githubusercontent.com/hookzof/socks5_list/master/tg/mtproto.json");
            if(!res.ok) throw new Error("Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§");
            const data = await res.json();
            allProxies = (Array.isArray(data) ? data : data.proxies || []).map((p, i) => ({
                id: i,
                server: p.server || p.host,
                port: p.port,
                secret: p.secret,
                country: getCountryName(p.country),
                status: 'unknown
