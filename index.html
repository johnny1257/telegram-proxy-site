<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>سایت پراکسی تلگرام</title>

<!-- فونت‌های فارسی و انگلیسی -->
<style>
@import url('https://fonts.googleapis.com/css2?family=Vazirmatn&display=swap');
@import url('https://fonts.googleapis.com/css2?family=Roboto&display=swap');
</style>

<style>
  body {
    margin: 0; padding: 0;
    font-family: 'Vazirmatn', Tahoma, sans-serif;
    background: #121212;
    color: #e0e0e0;
    min-height: 100vh;
    display: flex; flex-direction: column; align-items: center;
    padding: 20px;
  }
  h1 {
    margin-bottom: 20px;
  }
  button {
    cursor: pointer;
    background-color: #0088cc;
    border: none;
    padding: 10px 16px;
    border-radius: 6px;
    color: #fff;
    font-weight: 600;
    transition: background-color 0.3s ease;
  }
  button:hover:not(:disabled) {
    background-color: #00aaff;
  }
  button:disabled {
    background-color: #555;
    cursor: not-allowed;
  }
  .proxy-card {
    background: #222;
    margin-bottom: 15px;
    padding: 15px 20px;
    border-radius: 10px;
    box-shadow: 0 0 10px #000;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }
  .proxy-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .proxy-server {
    font-weight: 700;
    font-size: 1.2rem;
    font-family: 'Roboto', sans-serif;
    direction: ltr;
    user-select: text;
  }
  .status-badge {
    font-size: 0.9rem;
    padding: 4px 10px;
    border-radius: 20px;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .status-good {
    background-color: #4caf50;
    color: #fff;
  }
  .status-medium {
    background-color: #ff9800;
    color: #fff;
  }
  .status-bad {
    background-color: #f44336;
    color: #fff;
  }
  .status-unknown {
    background-color: #607d8b;
    color: #fff;
  }
  .proxy-info {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 8px;
    font-size: 0.9rem;
    color: #bbb;
  }
  .proxy-info div {
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .country-flag {
    width: 24px;
    height: 18px;
    border-radius: 4px;
    object-fit: cover;
    box-shadow: 0 0 3px #000a;
  }
  .proxy-secret {
    font-family: 'Roboto Mono', monospace;
    background: #1e1e1e;
    padding: 8px;
    border-radius: 8px;
    font-size: 0.85rem;
    user-select: all;
    word-break: break-all;
    color: #ccc;
  }
  .btn-group {
    display: flex;
    gap: 12px;
    justify-content: center;
    margin-top: 10px;
  }
  .btn-group button {
    flex: 1;
    font-size: 0.9rem;
    padding: 8px 0;
  }
  #proxyCount, #activeCount {
    font-weight: 700;
    color: #00c8ff;
  }
  #headerInfo {
    margin-bottom: 15px;
    font-size: 1.1rem;
  }
  .toast {
    position: fixed;
    top: 20px;
    right: 20px;
    background: #333;
    padding: 14px 22px;
    border-radius: 8px;
    color: #fff;
    font-weight: 600;
    box-shadow: 0 0 10px #000a;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
    z-index: 9999;
  }
  .toast.show {
    opacity: 1;
    pointer-events: auto;
  }
</style>

</head>
<body>

<h1>لیست پراکسی‌های تلگرام</h1>
<div id="headerInfo">
    تعداد کل پراکسی‌ها: <span id="proxyCount">0</span> | پراکسی‌های فعال: <span id="activeCount">0</span>
</div>

<div>
  <button id="refreshBtn">بروزرسانی لیست</button>
  <button id="testAllBtn">تست همه</button>
</div>

<div id="proxyList" style="margin-top:20px; width: 100%; max-width: 600px;"></div>

<div class="btn-group" style="max-width: 600px; width: 100%; margin-top: 10px;">
  <button id="loadMoreBtn" style="width: 100%;">نمایش بیشتر</button>
</div>

<div id="toast" class="toast"></div>

<script>
// لینک فایل پراکسی با فرمت json (بروزرسانی آن لازم است)
const proxySourceURL = "https://raw.githubusercontent.com/hookzof/socks5_list/master/tg/mtproto.json";

let allProxies = [];
let visibleProxies = [];
const perPage = 9;

const elements = {
  refreshBtn: document.getElementById("refreshBtn"),
  testAllBtn: document.getElementById("testAllBtn"),
  proxyCount: document.getElementById("proxyCount"),
  activeCount: document.getElementById("activeCount"),
  proxyList: document.getElementById("proxyList"),
  loadMoreBtn: document.getElementById("loadMoreBtn"),
  toast: document.getElementById("toast"),
};

const countryFlags = {
  "Russia": "https://flagcdn.com/w40/ru.png",
  "Netherlands": "https://flagcdn.com/w40/nl.png",
  "United States": "https://flagcdn.com/w40/us.png",
  "Germany": "https://flagcdn.com/w40/de.png",
  "France": "https://flagcdn.com/w40/fr.png",
  "United Kingdom": "https://flagcdn.com/w40/gb.png",
  "Canada": "https://flagcdn.com/w40/ca.png",
  "Italy": "https://flagcdn.com/w40/it.png",
  "Spain": "https://flagcdn.com/w40/es.png",
  "Turkey": "https://flagcdn.com/w40/tr.png",
  "Finland": "https://flagcdn.com/w40/fi.png",
  "Sweden": "https://flagcdn.com/w40/se.png",
  "Poland": "https://flagcdn.com/w40/pl.png",
  "Iran": "https://flagcdn.com/w40/ir.png"
};

const getCountryFlag = (country) => {
  return countryFlags[country] || "https://flagcdn.com/w40/un.png";
};

const getCountryName = (country) => {
  const translations = {
    "Russia": "روسیه",
    "Netherlands": "هلند",
    "United States": "آمریکا",
    "Germany": "آلمان",
    "France": "فرانسه",
    "United Kingdom": "انگلستان",
    "Canada": "کانادا",
    "Italy": "ایتالیا",
    "Spain": "اسپانیا",
    "Turkey": "ترکیه",
    "Finland": "فنلاند",
    "Sweden": "سوئد",
    "Poland": "لهستان",
    "Iran": "ایران",
  };
  return translations[country] || country || "نامشخص";
};

function showToast(message, duration = 3000) {
  const toast = elements.toast;
  toast.textContent = message;
  toast.classList.add("show");
  setTimeout(() => {
    toast.classList.remove("show");
  }, duration);
}

function createProxyCard(proxy) {
  const card = document.createElement("div");
  card.className = "proxy-card";

  const flagSrc = getCountryFlag(proxy.country);
  const countryName = getCountryName(proxy.country);

  card.innerHTML = `
    <div class="proxy-header">
      <div class="proxy-server">${proxy.server}</div>
      <div class="status-badge status-unknown" id="status-${proxy.id}">نامشخص</div>
    </div>
    <div class="proxy-info">
      <div><img class="country-flag" src="${flagSrc}" alt="${countryName}" title="${countryName}" /> ${countryName}</div>
      <div>پورت: ${proxy.port}</div>
      <div id="ping-${proxy.id}">تست نشده</div>
    </div>
    <div class="proxy-secret" title="کلید امنیتی">${proxy.secret}</div>
    <div class="btn-group">
      <button onclick="testPing(${proxy.id})">تست</button>
      <button onclick="copyProxy(${proxy.id})">کپی</button>
      <button onclick="connectTelegram(${proxy.id})">اتصال</button>
    </div>
  `;
  return card;
}

function renderProxies() {
  elements.proxyList.innerHTML = "";
  visibleProxies.forEach(proxy => {
    elements.proxyList.appendChild(createProxyCard(proxy));
  });
}

async function loadProxies() {
  try {
    const res = await fetch(proxySourceURL);
    if (!res.ok) throw new Error("خطا در دریافت لیست پراکسی‌ها");
    const data = await res.json();

    allProxies = (Array.isArray(data) ? data : data.proxies || []).map((p, i) => ({
      id: i,
      server: p.server || p.host,
      port: p.port,
      secret: p.secret,
      country: p.country || "نامشخص",
      status: "unknown",
      ping: null,
    }));
    visibleProxies = allProxies.slice(0, perPage);
    renderProxies();
    updateCounts();
    showToast("✅ لیست پراکسی‌ها به‌روزرسانی شد.");
  } catch {
    showToast("❌ خطا در بارگذاری پراکسی‌ها، استفاده از لیست پیش‌فرض");
    // لیست پیشفرض ساده
    allProxies = [
      { id: 0, server: "149.154.175.50", port: "443", secret: "abcd1234", country: "Russia", status: "unknown", ping: null },
      { id: 1, server: "149.154.167.40", port: "443", secret: "efgh5678", country: "United States", status: "unknown", ping: null },
    ];
    visibleProxies = allProxies.slice(0, perPage);
    renderProxies();
    updateCounts();
  }
}

function updateCounts() {
  elements.proxyCount.textContent = allProxies.length;
  elements.activeCount.textContent = allProxies.filter(p => p.status === "good").length;
}

async function testPing(id) {
  const proxy = allProxies.find(p => p.id === id);
  if (!proxy) return;

  const pingElem = document.getElementById(`ping-${id}`);
  const statusElem = document.getElementById(`status-${id}`);

  pingElem.textContent = "در حال تست...";
  statusElem.textContent = "در حال تست...";
  statusElem.className = "status-badge status-unknown";

  // شبیه‌سازی تست پینگ
  const pingTime = Math.floor(Math.random() * 600) + 50;
  await new Promise(r => setTimeout(r, pingTime));

  proxy.ping = pingTime;
  if (pingTime < 250) {
    proxy.status = "good";
    statusElem.className = "status-badge status-good";
    statusElem.textContent = "عالی";
    pingElem.textContent = pingTime + " ms";
    pingElem.style.color = "#4caf50";
  } else if (pingTime < 500) {
    proxy.status = "medium";
    statusElem.className = "status-badge status-medium";
    statusElem.textContent = "متوسط";
    pingElem.textContent = pingTime + " ms";
    pingElem.style.color = "#ff9800";
  } else {
    proxy.status = "bad";
    statusElem.className = "status-badge status-bad";
    statusElem.textContent = "ضعیف";
    pingElem.textContent = pingTime + " ms";
    pingElem.style.color = "#f44336";
  }
  updateCounts();
}

function copyProxy(id) {
  const proxy = allProxies.find(p => p.id === id);
  if (!proxy) return;
  const proxyURL = `tg://proxy?server=${proxy.server}&port=${proxy.port}&secret=${proxy.secret}`;
  navigator.clipboard.writeText(proxyURL).then(() => {
    showToast("✅ لینک پروکسی کپی شد.");
  }).catch(() => {
    showToast("❌ خطا در کپی کردن لینک.");
  });
}

function connectTelegram(id) {
  const proxy = allProxies.find(p => p.id === id);
  if (!proxy) return;
  const proxyURL = `tg://proxy?server=${proxy.server}&port=${proxy.port}&secret=${proxy.secret}`;
  window.location.href = proxyURL;
  showToast("🚀 در حال تلاش برای اتصال به تلگرام...");
}

elements.refreshBtn.addEventListener("click", loadProxies);

elements.testAllBtn.addEventListener("click", async () => {
  for (const proxy of visibleProxies) {
    await testPing(proxy.id);
  }
  showToast("✅ تست همه پراکسی‌ها به پایان رسید.");
});

elements.loadMoreBtn.addEventListener("click", () => {
  const currentCount = visibleProxies.length;
  const next = allProxies.slice(currentCount, currentCount + perPage);
  if (next.length === 0) {
    showToast("📌 پراکسی جدیدی برای نمایش نیست.");
    return;
  }
  visibleProxies = visibleProxies.concat(next);
  renderProxies();
});

window.addEventListener("load", () => {
  loadProxies();
});
</script>

</body>
</html>
