<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>داشبورد پروکسی تلگرام — MTProto & SOCKS5</title>
<style>
@import url('https://cdn.jsdelivr.net/gh/rastikerdar/vazir-font@v30.1.0/dist/font-face.css');
body{margin:0;font-family:'Vazir',sans-serif;background:#0e1117;color:#e6edf3}
header{position:sticky;top:0;background:#161b22;padding:12px;display:flex;flex-direction:column;gap:12px;align-items:center;justify-content:center}
.title-container{display:flex;flex-direction:column;align-items:center;gap:6px;width:100%;max-width:600px;}
.title{font-family:'Vazir Black',sans-serif;font-size:52px;background:linear-gradient(135deg,#ff0057,#ffdd00,#00fff0,#ff0057);background-clip:text;-webkit-background-clip:text;color:transparent;text-shadow:4px 4px 14px rgba(0,0,0,0.85),6px 6px 20px rgba(0,0,0,0.65);font-weight:900;letter-spacing:3px;text-align:center}
.search-container{display:flex;gap:6px;width:100%}
input,button{padding:8px 12px;border-radius:10px;border:none;font-size:14px;font-family:'Vazir',sans-serif}
input{flex:1}
button{background:#2f81f7;color:#fff;cursor:pointer;transition:0.3s}
button:hover{background:#3b93f9}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:12px;padding:12px;width:100%;max-width:1200px;margin:auto}
.card{background:#0d1117;border:1px solid #30363d;border-radius:12px;padding:12px;display:flex;flex-direction:column;gap:6px}
.actions button{margin:2px 0;width:100%;border-radius:6px;cursor:pointer;transition:0.3s;font-weight:bold}
.actions button.open{background:#4caf50;color:#fff}
.actions button.copy{background:#ff9800;color:#fff}
.actions button.qr{background:#2196f3;color:#fff}
.kbd{font-family:monospace;background:#11151b;border:1px solid #30363d;border-radius:6px;padding:2px 4px;color:#9fb5d1}
.flag{width:24px;height:16px;vertical-align:middle;margin-left:4px;border:1px solid #30363d;}
.ping-green{color:#4caf50;font-weight:bold}
.ping-yellow{color:#ffeb3b;font-weight:bold}
.ping-red{color:#f44336;font-weight:bold}
</style>
</head>
<body>
<header>
<div class="title-container">
<div class="title">پرشین رایانه</div>
<div class="search-container">
<input type="text" id="filterInput" placeholder="جستجو بر اساس کشور یا provider">
<button id="btnClear">پاک کردن</button>
</div>
</div>
</header>
<main>
<div class="grid" id="grid"></div>
</main>
<dialog id="qrModal" style="border-radius:16px;background:#0d1117;color:#e6edf3;padding:12px;">
  <div style="display:flex;flex-direction:column;align-items:center;gap:10px;">
    <img id="qrImg" style="width:240px;height:240px;border-radius:12px;border:1px solid #30363d;background:#0b0f14">
    <div id="qrText" style="word-break:break-all;font-size:12px;color:#9aa6b2"></div>
    <div style="display:flex;gap:6px;"><button id="qrCopy">کپی لینک</button><button id="qrClose">بستن</button></div>
  </div>
</dialog>
<script>
const grid=document.getElementById('grid');
const filterInput=document.getElementById('filterInput');
const btnClear=document.getElementById('btnClear');
const qrModal=document.getElementById('qrModal');
const qrImg=document.getElementById('qrImg');
const qrText=document.getElementById('qrText');
const qrCopy=document.getElementById('qrCopy');
const qrClose=document.getElementById('qrClose');

let proxies=[];
const apiUrl='https://raw.githubusercontent.com/hookzof/socks5_list/master/tg/mtproto.json';
const proxyType='mtproto';

function flagEmoji(country){
  if(!country) return '';
  return `<img class='flag' src='https://flagcdn.com/w20/${country.toLowerCase()}.png'>`;
}

function pingClass(ping){
  if(ping<300) return 'ping-green';
  if(ping<=700) return 'ping-yellow';
  return 'ping-red';
}

function toLinkMTProto({host,port,secret}){
  const sec=encodeURIComponent(secret.replace(/^0x/i,''));
  return `tg://proxy?server=${encodeURIComponent(host)}&port=${encodeURIComponent(port)}&secret=${sec}`;
}

function cardEl(proxy,type){
  const el=document.createElement('div');
  el.className='card';
  let content='';
  const pingCls=pingClass(proxy.ping);
  if(type==='mtproto'){
    const link=toLinkMTProto(proxy);
    content=`<div>سرور: <span class='kbd'>${proxy.host}</span></div><div>پورت: <span class='kbd'>${proxy.port}</span></div><div>سیکرت: <span class='kbd'>${String(proxy.secret).slice(0,6)}…${String(proxy.secret).slice(-4)}</span></div>
<div>کشور: ${proxy.country||''} ${flagEmoji(proxy.country)}</div><div>Provider: ${proxy.provider||''}</div><div>Uptime: ${proxy.uptime||''}%</div><div>AddTime: ${proxy.addTime||''}</div><div>Ping: <span class='${pingCls}'>${proxy.ping||''}ms</span></div>`;
    el.innerHTML=`${content}<div class="actions">
<button class='open' data-act="open" data-url="${link}">باز کردن در تلگرام</button>
<button class='copy' data-act="copy" data-url="${link}">کپی لینک</button>
<button class='qr' data-act="qr" data-url="${link}">نمایش QR</button>
</div>`;
  } else {
    content=`<div>IP: <span class='kbd'>${proxy.ip}</span></div><div>پورت: <span class='kbd'>${proxy.port}</span></div><div>کشور: ${proxy.country||''} ${flagEmoji(proxy.country)}</div><div>Provider: ${proxy.provider||''}</div><div>AddTime: ${proxy.addTime||''}</div><div>Ping: <span class='${pingCls}'>${proxy.ping||''}ms</span></div>`;
    el.innerHTML=`${content}<div class="actions">
<button class='copy' data-act="copy" data-url="${proxy.ip}:${proxy.port}">کپی IP:PORT</button>
</div>`;
  }
  el.addEventListener('click',ev=>{
    const b=ev.target.closest('button');
    if(!b) return;
    const act=b.getAttribute('data-act');
    const url=b.getAttribute('data-url');
    if(act==='open'){window.location.href=url;}
    else if(act==='copy'){navigator.clipboard.writeText(url).then(()=>{b.textContent='کپی شد ✓';setTimeout(()=>b.textContent=act==='copy'?'کپی لینک':'کپی tg://',1200);});}
    else if(act==='qr'){qrImg.src=`https://api.qrserver.com/v1/create-qr-code/?size=240x240&data=${encodeURIComponent(url)}`;qrText.textContent=url;qrCopy.onclick=()=>navigator.clipboard.writeText(url);qrModal.showModal();}
  });
  return el;
}

function renderProxies(){
  grid.innerHTML='';
  const filter=filterInput.value.toLowerCase();
  proxies.filter(p=>!filter||(p.country&&p.country.toLowerCase().includes(filter))||(p.provider&&p.provider.toLowerCase().includes(filter))).forEach(p=>{
    if(proxyType==='mtproto'&&p.host&&p.port&&p.secret){grid.appendChild(cardEl(p,'mtproto'))}
    else if(proxyType==='socks'&&p.ip&&p.port){grid.appendChild(cardEl(p,'socks'))}
  });
}

async function fetchList(){
  grid.innerHTML='در حال دریافت...';
  try{
    const res=await fetch(`${apiUrl}?type=${proxyType}`);
    if(!res.ok) throw new Error(res.status);
    const data=await res.json();
    proxies=Array.isArray(data)?data:[data];
    renderProxies();
  }catch(e){grid.innerHTML='خطا در دریافت اطلاعات';console.error(e);}
}

btnClear.addEventListener('click',()=>{grid.innerHTML='';proxies=[]});
filterInput.addEventListener('input',renderProxies);
qrClose.addEventListener('click',()=>qrModal.close());

fetchList();
</script>
</body>
</html>
