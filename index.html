<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ğŸ“¡ Ù¾Ø±Ø§Ú©Ø³ÛŒâ€ŒÙ‡Ø§ÛŒ ØªÙ„Ú¯Ø±Ø§Ù…</title>

<!-- ÙÙˆÙ†Øªâ€ŒÙ‡Ø§ÛŒ ÙØ§Ø±Ø³ÛŒ Ùˆ Ø§Ù†Ú¯Ù„ÛŒØ³ÛŒ -->
<link href="https://cdn.jsdelivr.net/gh/rastikerdar/vazir-font@v30.1.0/dist/font-face.css" rel="stylesheet" />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet" />

<!-- ÙÙˆÙ†Øªâ€ŒØ¢ÙˆØ³Ø§Ù… -->
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>

<style>
  body {
    margin:0; padding:20px;
    font-family: 'Vazir', Tahoma, sans-serif;
    background: #121212;
    color: #eee;
    min-height: 100vh;
  }
  .container {
    max-width: 900px;
    margin: 0 auto;
  }
  h1 {
    text-align: center;
    margin-bottom: 20px;
    font-weight: 900;
  }
  .counts {
    display: flex;
    justify-content: space-between;
    margin-bottom: 15px;
    font-weight: 700;
    font-size: 1.1rem;
  }
  .btn-group {
    display: flex;
    justify-content: center;
    gap: 12px;
    margin-bottom: 15px;
  }
  button {
    cursor: pointer;
    border: none;
    border-radius: 10px;
    padding: 10px 20px;
    font-weight: 700;
    font-size: 1rem;
    color: #eee;
    background: #374151;
    display: flex;
    align-items: center;
    gap: 8px;
    transition: background-color 0.3s ease;
  }
  button:hover:not(:disabled) {
    background-color: #4b5563;
  }
  button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }
  button.primary {
    background-color: #3b82f6;
  }
  button.primary:hover:not(:disabled) {
    background-color: #2563eb;
  }
  button i {
    font-size: 1.2rem;
  }
  #proxyList {
    display: grid;
    grid-template-columns: repeat(auto-fill,minmax(280px,1fr));
    gap: 20px;
  }
  .proxy-card {
    background: #1f2937;
    border-radius: 15px;
    padding: 15px 20px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.6);
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    transition: transform 0.3s ease;
  }
  .proxy-card:hover {
    transform: translateY(-6px);
    box-shadow: 0 12px 28px rgba(0,0,0,0.85);
  }
  .proxy-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
  }
  .proxy-server {
    font-family: 'Inter', Tahoma, sans-serif;
    font-weight: 800;
    font-size: 1.3rem;
    user-select: text;
  }
  .status-badge {
    font-weight: 700;
    padding: 5px 10px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.95rem;
  }
  .status-good {background:#22c55e; color:#d1fae5;}
  .status-medium {background:#eab308; color:#78350f;}
  .status-bad {background:#ef4444; color:#fcdcdc;}
  .status-unknown {background:#64748b; color:#e2e8f0;}

  .status-dot {
    width: 14px; height: 14px;
    border-radius: 50%;
    box-shadow: 0 0 7px rgba(0,0,0,0.25);
  }
  .dot-good { background: #22c55e; }
  .dot-medium { background: #eab308; }
  .dot-bad { background: #ef4444; }
  .dot-unknown { background: #64748b; }

  .proxy-details {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px 15px;
    color: #9ca3af;
    font-size: 0.9rem;
    margin-bottom: 10px;
  }
  .proxy-details div {
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .proxy-details .flag-emoji {
    font-size: 1.5rem;
    border-radius: 6px;
    padding: 2px 7px;
    background: #111827;
    box-shadow: 0 2px 6px rgba(0,0,0,0.8);
    user-select:none;
  }
  .proxy-details .english-text {
    font-family: 'Inter', Tahoma, sans-serif;
  }
  .secret-key {
    background-color: #111827;
    border-radius: 10px;
    padding: 9px 14px;
    font-family: 'Inter', monospace;
    font-size: 0.9rem;
    word-break: break-word;
    user-select: all;
    border: 1px solid #374151;
    color: #cbd5e1;
    margin-bottom: 12px;
  }
  .btn-actions {
    display: flex;
    gap: 12px;
    justify-content: center;
  }

  /* Ù†ÙˆØªÛŒÙÛŒÚ©ÛŒØ´Ù† */
  #toast {
    position: fixed;
    top: 1rem;
    left: 50%;
    transform: translateX(-50%) translateY(-120%);
    background-color: #333;
    color: #eee;
    padding: 14px 24px;
    border-radius: 12px;
    box-shadow: 0 8px 18px rgb(0 0 0 / 0.6);
    opacity: 0;
    pointer-events: none;
    transition: all 0.35s ease;
    font-weight: 600;
    z-index: 9999;
    max-width: 90vw;
    text-align: center;
  }
  #toast.show {
    opacity: 1;
    pointer-events: auto;
    transform: translateX(-50%) translateY(0);
  }

  @media (max-width:480px) {
    .proxy-details {
      grid-template-columns: 1fr;
    }
    .btn-actions {
      flex-direction: column;
    }
    button {
      width: 100%;
      justify-content: center;
    }
  }
</style>
</head>
<body>

<div class="container">
  <h1>ğŸ“¡ Ù¾Ø±Ø§Ú©Ø³ÛŒâ€ŒÙ‡Ø§ÛŒ ØªÙ„Ú¯Ø±Ø§Ù…</h1>

  <div class="counts" aria-live="polite" aria-atomic="true">
    <div>ØªØ¹Ø¯Ø§Ø¯ Ú©Ù„: <span id="proxyCount">0</span></div>
    <div>Ù¾Ø±Ø§Ú©Ø³ÛŒâ€ŒÙ‡Ø§ÛŒ ÙØ¹Ø§Ù„: <span id="activeCount">0</span></div>
  </div>

  <div class="btn-group">
    <button id="refreshBtn" title="Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù¾Ø±Ø§Ú©Ø³ÛŒâ€ŒÙ‡Ø§">
      <i class="fas fa-sync-alt"></i> Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ
    </button>
    <button id="testAllBtn" class="primary" title="ØªØ³Øª Ù‡Ù…Ù‡ Ù¾Ø±Ø§Ú©Ø³ÛŒâ€ŒÙ‡Ø§">
      <i class="fas fa-bolt"></i> ØªØ³Øª Ù‡Ù…Ù‡
    </button>
  </div>

  <div id="proxyList" role="list" aria-label="Ù„ÛŒØ³Øª Ù¾Ø±Ø§Ú©Ø³ÛŒâ€ŒÙ‡Ø§"></div>
</div>

<div id="toast" role="alert" aria-live="assertive" aria-atomic="true"></div>

<script>
  const countryTranslations = {
    'Russia': 'Ø±ÙˆØ³ÛŒÙ‡',
    'Netherlands': 'Ù‡Ù„Ù†Ø¯',
    'United States': 'Ø¢Ù…Ø±ÛŒÚ©Ø§',
    'Germany': 'Ø¢Ù„Ù…Ø§Ù†',
    'France': 'ÙØ±Ø§Ù†Ø³Ù‡',
    'United Kingdom': 'Ø§Ù†Ú¯Ù„Ø³ØªØ§Ù†',
    'Canada': 'Ú©Ø§Ù†Ø§Ø¯Ø§',
    'Italy': 'Ø§ÛŒØªØ§Ù„ÛŒØ§',
    'Spain': 'Ø§Ø³Ù¾Ø§Ù†ÛŒØ§',
    'Turkey': 'ØªØ±Ú©ÛŒÙ‡',
    'Finland': 'ÙÙ†Ù„Ø§Ù†Ø¯',
    'Sweden': 'Ø³ÙˆØ¦Ø¯',
    'Poland': 'Ù„Ù‡Ø³ØªØ§Ù†',
    'Iran': 'Ø§ÛŒØ±Ø§Ù†',
  };

  const countryEmojis = {
    'Russia': 'ğŸ‡·ğŸ‡º',
    'Netherlands': 'ğŸ‡³ğŸ‡±',
    'United States': 'ğŸ‡ºğŸ‡¸',
    'Germany': 'ğŸ‡©ğŸ‡ª',
    'France': 'ğŸ‡«ğŸ‡·',
    'United Kingdom': 'ğŸ‡¬ğŸ‡§',
    'Canada': 'ğŸ‡¨ğŸ‡¦',
    'Italy': 'ğŸ‡®ğŸ‡¹',
    'Spain': 'ğŸ‡ªğŸ‡¸',
    'Turkey': 'ğŸ‡¹ğŸ‡·',
    'Finland': 'ğŸ‡«ğŸ‡®',
    'Sweden': 'ğŸ‡¸ğŸ‡ª',
    'Poland': 'ğŸ‡µğŸ‡±',
    'Iran': 'ğŸ‡®ğŸ‡·',
  };

  let allProxies = [];
  let isLoading = false;

  const elements = {
    refreshBtn: document.getElementById('refreshBtn'),
    testAllBtn: document.getElementById('testAllBtn'),
    proxyCount: document.getElementById('proxyCount'),
    activeCount: document.getElementById('activeCount'),
    proxyList: document.getElementById('proxyList'),
    toast: document.getElementById('toast'),
  };

  function showToast(message, type = 'info') {
    const bgColors = {
      success: '#22c55e',
      error: '#ef4444',
      warning: '#eab308',
      info: '#2563eb',
    };
    elements.toast.textContent = message;
    elements.toast.style.backgroundColor = bgColors[type] || bgColors.info;
    elements.toast.classList.add('show');
    setTimeout(() => elements.toast.classList.remove('show'), 3500);
  }

  function getStatusInfo(status) {
    switch(status) {
      case 'good': return { text: 'Ø¹Ø§Ù„ÛŒ', className: 'status-good', dotClass: 'dot-good', icon: 'fas fa-circle-check' };
      case 'medium': return { text: 'Ù…ØªÙˆØ³Ø·', className: 'status-medium', dotClass: 'dot-medium', icon: 'fas fa-exclamation-triangle' };
      case 'bad': return { text: 'Ø¶Ø¹ÛŒÙ', className: 'status-bad', dotClass: 'dot-bad', icon: 'fas fa-circle-xmark' };
      default: return { text: 'Ù†Ø§Ù…Ø´Ø®Øµ', className: 'status-unknown', dotClass: 'dot-unknown', icon: 'fas fa-question-circle' };
    }
  }

  function renderProxies() {
    elements.proxyList.innerHTML = '';
    if (allProxies.length === 0) {
      elements.proxyList.innerHTML = `<p style="text-align:center; color:#888; margin-top: 2rem;">Ù‡ÛŒÚ† Ù¾Ø±Ø§Ú©Ø³ÛŒâ€ŒØ§ÛŒ Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.</p>`;
      return;
    }
    allProxies.forEach(proxy => {
      const status = getStatusInfo(proxy.status);
      const countryName = countryTranslations[proxy.country] || proxy.country || 'Ù†Ø§Ù…Ø´Ø®Øµ';
      const countryFlag = countryEmojis[proxy.country] || 'ğŸŒ';

      const proxyDiv = document.createElement('div');
      proxyDiv.className = 'proxy-card';
      proxyDiv.setAttribute('role', 'listitem');
      proxyDiv.innerHTML = `
        <div class="proxy-header">
          <div>
            <span class="status-dot ${status.dotClass}" title="${status.text}"></span>
            <span class="proxy-server english-text">${proxy.server}</span>
          </div>
          <span class="status-badge ${status.className}">
            <i class="${status.icon}"></i> ${status.text}
          </span>
        </div>
        <div class="proxy-details" aria-label="Ø¬Ø²Ø¦ÛŒØ§Øª Ù¾Ø±Ø§Ú©Ø³ÛŒ">
          <div class="country-flag" title="Ú©Ø´ÙˆØ± ${countryName}">
            <span class="flag-emoji">${countryFlag}</span>
            <span>${countryName}</span>
          </div>
          <div>Ù¾ÙˆØ±Øª: <span class="english-text">${proxy.port}</span></div>
          <div>Ù¾ÛŒÙ†Ú¯: <span>${proxy.ping !== null ? proxy.ping + ' ms' : 'ØªØ³Øª Ù†Ø´Ø¯Ù‡'}</span></div>
        </div>
        <div class="secret-key english-text" title="Ú©Ù¾ÛŒ Ú©Ù„ÛŒØ¯ Ø§Ù…Ù†ÛŒØªÛŒ (Secret)">${proxy.secret}</div>
        <div class="btn-actions">
          <button class="btn" onclick="testPing(${proxy.id})" title="ØªØ³Øª Ù¾ÛŒÙ†Ú¯"><i class="fas fa-bolt"></i> ØªØ³Øª</button>
          <button class="btn" onclick="copyProxy(${proxy.id})" title="Ú©Ù¾ÛŒ"><i class="fas fa-copy"></i> Ú©Ù¾ÛŒ</button>
          <button class="btn primary" onclick="connectTelegram(${proxy.id})" title="Ø§ØªØµØ§Ù„"><i class="fas fa-paper-plane"></i> Ø§ØªØµØ§Ù„</button>
        </div>
      `;
      elements.proxyList.appendChild(proxyDiv);
    });
  }

  async function loadProxies() {
    if (isLoading) return;
    isLoading = true;
    elements.refreshBtn.disabled = true;
    elements.testAllBtn.disabled = true;
    showToast('â³ Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù¾Ø±Ø§Ú©Ø³ÛŒâ€ŒÙ‡Ø§...', 'info');

    try {
      const res = await fetch('https://raw.githubusercontent.com/hookzof/socks5_list/master/tg/mtproto.json');
      if (!res.ok) throw new Error('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§');
      const data = await res.json();

      allProxies = (Array.isArray(data) ? data : data.proxies || []).map((p, i) => ({
        id: i,
        server: p.server || p.host || 'Ù†Ø§Ù…Ø´Ø®Øµ',
        port: p.port || 'Ù†Ø§Ù…Ø´Ø®Øµ',
        secret: p.secret || p.user || '',
        country: p.country || 'Ù†Ø§Ù…Ø´Ø®Øµ',
        status: 'unknown',
        ping: null,
      }));

      showToast('âœ… Ù¾Ø±Ø§Ú©Ø³ÛŒâ€ŒÙ‡Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯Ù†Ø¯', 'success');
    } catch (e) {
      showToast('âš ï¸ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ù¾Ø±Ø§Ú©Ø³ÛŒâ€ŒÙ‡Ø§ Ù†Ø§Ù…ÙˆÙÙ‚ Ø¨ÙˆØ¯ØŒ Ø§Ø² Ù„ÛŒØ³Øª Ù¾ÛŒØ´â€ŒÙØ±Ø¶ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯', 'warning');
      allProxies = [
        { id: 0, server: "proxy.digitalresistance.dog", port: "443", secret: "ddd41d8cd98f00b204e9800998ecf8427e", country: "Germany", status: 'unknown', ping: null },
        { id: 1, server: "149.154.175.100", port: "443", secret: "ee1111111111111111111111111111111111", country: "Russia", status: 'unknown', ping: null },
        { id: 2, server: "mtpro.co.uk", port: "443", secret: "ee0000000000000000000000000000000000", country: "United Kingdom", status: 'unknown', ping: null }
      ];
    } finally {
      isLoading = false;
      elements.refreshBtn.disabled = false;
      elements.testAllBtn.disabled = false;
      updateCounts();
      renderProxies();
    }
  }

  async function testPing(id) {
    const proxy = allProxies.find(p => p.id === id);
    if (!proxy) return;

    // Ù†Ù…Ø§ÛŒØ´ ÙˆØ¶Ø¹ÛŒØª Ø¯Ø± Ø­Ø§Ù„ ØªØ³Øª
    proxy.status = 'unknown';
    proxy.ping = null;
    renderProxies();

    elements.refreshBtn.disabled = true;
    elements.testAllBtn.disabled = true;
    showToast(`âŒ› Ø¯Ø± Ø­Ø§Ù„ ØªØ³Øª Ù¾ÛŒÙ†Ú¯ ${proxy.server}...`, 'info');

    // Ø´Ø¨ÛŒÙ‡ Ø³Ø§Ø²ÛŒ Ù¾ÛŒÙ†Ú¯ Ø¨Ø§ ØªØ§Ø®ÛŒØ± ØªØµØ§Ø¯ÙÛŒ (100-800 Ù…ÛŒÙ„ÛŒ Ø«Ø§Ù†ÛŒÙ‡)
    const delay = Math.floor(Math.random() * 700) + 100;
    await new Promise(r => setTimeout(r, delay));

    proxy.ping = delay;
    if (delay < 250) proxy.status = 'good';
    else if (delay < 600) proxy.status = 'medium';
    else proxy.status = 'bad';

    elements.refreshBtn.disabled = false;
    elements.testAllBtn.disabled = false;

    updateCounts();
    renderProxies();
    showToast(`âœ… ØªØ³Øª Ù¾Ø±Ø§Ú©Ø³ÛŒ ${proxy.server} Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯`, 'success');
  }

  async function testAllProxies() {
    if (isLoading) return;
    elements.testAllBtn.disabled = true;
    elements.refreshBtn.disabled = true;
    showToast('âŒ› Ø¯Ø± Ø­Ø§Ù„ ØªØ³Øª Ù‡Ù…Ù‡ Ù¾Ø±Ø§Ú©Ø³ÛŒâ€ŒÙ‡Ø§...', 'info');

    for (let proxy of allProxies) {
      await testPing(proxy.id);
    }

    elements.testAllBtn.disabled = false;
    elements.refreshBtn.disabled = false;
    showToast('âœ… ØªØ³Øª Ù‡Ù…Ù‡ Ù¾Ø±Ø§Ú©Ø³ÛŒâ€ŒÙ‡Ø§ Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯', 'success');
  }

  function copyProxy(id) {
    const proxy = allProxies.find(p => p.id === id);
    if (!proxy) return;
    const proxyUrl = `tg://proxy?server=${proxy.server}&port=${proxy.port}&secret=${proxy.secret}`;
    navigator.clipboard.writeText(proxyUrl)
      .then(() => showToast('âœ… Ù„ÛŒÙ†Ú© Ù¾Ø±Ø§Ú©Ø³ÛŒ Ú©Ù¾ÛŒ Ø´Ø¯', 'success'))
      .catch(() => showToast('âŒ Ø®Ø·Ø§ Ø¯Ø± Ú©Ù¾ÛŒ Ù„ÛŒÙ†Ú©', 'error'));
  }

  function connectTelegram(id
